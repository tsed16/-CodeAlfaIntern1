<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <title>Task 2 — Calculator</title>
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <style>
        :root{
            --bg:#0f1724;
            --panel:#0b1220;
            --accent:#06b6d4;
            --muted:#94a3b8;
            --glass: rgba(255,255,255,0.04);
            --btn: linear-gradient(180deg,#0f1724,#071025);
        }
        *{box-sizing:border-box;font-family:Inter,ui-sans-serif,system-ui,Segoe UI,Roboto,"Helvetica Neue",Arial;}
        html,body{height:100%;margin:0;background:
            radial-gradient(1200px 600px at 10% 10%, rgba(6,182,212,0.06), transparent 10%),
            radial-gradient(800px 400px at 90% 90%, rgba(99,102,241,0.04), transparent 10%),
            var(--bg);
            color:#e6eef6;
            -webkit-font-smoothing:antialiased;
            -moz-osx-font-smoothing:grayscale;
        }
        .wrap{
            min-height:100vh;
            display:flex;
            align-items:center;
            justify-content:center;
            padding:24px;
        }
        .calculator{
            width:360px;
            background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
            border-radius:16px;
            box-shadow: 0 8px 30px rgba(2,6,23,0.7), inset 0 1px 0 rgba(255,255,255,0.02);
            padding:18px;
            border:1px solid rgba(255,255,255,0.03);
        }

        .screen{
            background:var(--panel);
            border-radius:10px;
            padding:14px;
            margin-bottom:12px;
            min-height:88px;
            display:flex;
            flex-direction:column;
            justify-content:center;
            gap:6px;
            box-shadow: inset 0 -6px 24px rgba(2,6,23,0.6);
        }
        .expr{
            color:var(--muted);
            font-size:14px;
            overflow:hidden;
            white-space:nowrap;
            text-overflow:ellipsis;
            padding-right:8px;
        }
        .result{
            font-size:28px;
            font-weight:600;
            text-align:right;
            overflow:hidden;
            white-space:nowrap;
            text-overflow:ellipsis;
        }

        .keys{
            display:grid;
            grid-template-columns: repeat(4, 1fr);
            gap:10px;
        }

        button.key{
            background:var(--btn);
            color:#e6eef6;
            border:1px solid rgba(255,255,255,0.03);
            border-radius:10px;
            padding:14px 10px;
            font-size:18px;
            cursor:pointer;
            transition:transform .08s ease, box-shadow .08s ease;
            box-shadow: 0 4px 14px rgba(2,6,23,0.45);
            user-select:none;
        }
        button.key:hover{ transform: translateY(-3px); }
        button.key:active{ transform: translateY(0); }

        .key.op{ background: linear-gradient(180deg, rgba(6,182,212,0.12), rgba(6,182,212,0.06)); color:var(--accent); font-weight:600; }
        .key.eq{ grid-column: span 2; background: linear-gradient(90deg,#06b6d4,#6366f1); color:#061025; font-weight:700; box-shadow: 0 10px 30px rgba(6,182,212,0.15); }
        .key.zero{ grid-column: span 2; }

        .small{
            font-size:13px;
            opacity:0.9;
        }

        .hint{
            margin-top:10px;
            font-size:12px;
            color:var(--muted);
            text-align:center;
        }

        @media (max-width:420px){
            .calculator{ width:100%; }
        }
    </style>
</head>
<body>
    <div class="wrap">
        <main class="calculator" role="application" aria-label="Calculator">
            <div class="screen" aria-live="polite">
                <div id="expression" class="expr" aria-hidden="false">0</div>
                <div id="preview" class="result" aria-atomic="true">0</div>
            </div>

            <div class="keys" id="keys">
                <!-- Row 1 -->
                <button class="key" data-action="clear" title="Clear (Esc)">C</button>
                <button class="key" data-action="paren" title="Parentheses">( )</button>
                <button class="key" data-action="del" title="Delete (Backspace)">⌫</button>
                <button class="key op" data-value="÷" title="Divide">÷</button>

                <!-- Row 2 -->
                <button class="key" data-value="7">7</button>
                <button class="key" data-value="8">8</button>
                <button class="key" data-value="9">9</button>
                <button class="key op" data-value="×" title="Multiply">×</button>

                <!-- Row 3 -->
                <button class="key" data-value="4">4</button>
                <button class="key" data-value="5">5</button>
                <button class="key" data-value="6">6</button>
                <button class="key op" data-value="-" title="Subtract">−</button>

                <!-- Row 4 -->
                <button class="key" data-value="1">1</button>
                <button class="key" data-value="2">2</button>
                <button class="key" data-value="3">3</button>
                <button class="key op" data-value="+" title="Add">+</button>

                <!-- Row 5 -->
                <button class="key zero" data-value="0">0</button>
                <button class="key" data-value=".">.</button>
                <button class="key eq" data-action="equals" title="Equals (Enter)">=</button>
            </div>

            <div class="hint">Keyboard: 0‑9 . + - * / Enter = Backspace Esc</div>
        </main>
    </div>

    <script>
        (function(){
            // Elements
            const exprEl = document.getElementById('expression');
            const previewEl = document.getElementById('preview');
            const keys = document.getElementById('keys');

            // State
            let expression = '';

            // Helpers
            const isOperator = ch => ['+','-','*','/','×','÷'].includes(ch);
            const sanitizeForEval = s => s.replace(/×/g,'*').replace(/÷/g,'/').replace(/−/g,'-');

            function updateUI(){
                exprEl.textContent = expression || '0';
                // Provide a realtime result preview if expression can be evaluated
                const simple = sanitizeForEval(expression).trim();
                // Disallow dangerous characters; allow digits, operators, parentheses and dot and spaces
                if (simple === '') {
                    previewEl.textContent = '0';
                    return;
                }
                if (!/^[0-9+\-*/().\s]+$/.test(simple)) {
                    previewEl.textContent = 'Err';
                    return;
                }
                // Don't evaluate if expression ends with operator (except ')')
                if (/[+\-*/]\s*$/.test(simple)) {
                    // show partial value or nothing
                    previewEl.textContent = '';
                    return;
                }
                try {
                    // Use Function for evaluation in a local safe-ish scope
                    const val = Function('"use strict"; return (' + simple + ')')();
                    // Avoid showing long floats
                    if (typeof val === 'number' && isFinite(val)) {
                        previewEl.textContent = Number.isInteger(val) ? String(val) : String(Number(val.toFixed(10))).replace(/\.?0+$/,'');
                    } else {
                        previewEl.textContent = 'Err';
                    }
                } catch (e) {
                    previewEl.textContent = '';
                }
            }

            function append(char){
                // Special handling: map multipliers/division symbols already used onto display
                if (char === '*' ) char = '×';
                if (char === '/' ) char = '÷';
                // Replace last operator if user types another operator
                if (isOperator(char)) {
                    if (!expression) {
                        // allow negative start
                        if (char === '-' || char === '−') { expression += '-'; updateUI(); return; }
                        return;
                    }
                    // If last char is operator and user inputs operator, replace it
                    if (isOperator(expression.slice(-1))) {
                        expression = expression.slice(0,-1) + char;
                        updateUI();
                        return;
                    }
                }
                // Prevent multiple decimals in same number segment
                if (char === '.') {
                    const lastSegment = expression.split(/[\+\-\×\÷\*\/\s\(\)]/).pop();
                    if (lastSegment && lastSegment.includes('.')) return;
                    if (lastSegment === '') char = '0.';
                }
                expression += char;
                updateUI();
            }

            function clearAll(){
                expression = '';
                updateUI();
            }

            function del(){
                expression = expression.slice(0,-1);
                updateUI();
            }

            function toggleParen(){
                // Simple intelligent parentheses: add '(' if not balanced or add ')'
                const open = (expression.match(/\(/g)||[]).length;
                const close = (expression.match(/\)/g)||[]).length;
                if (open === close || /[\+\-\×\÷\*\/\(\s]$/.test(expression)) {
                    expression += '(';
                } else {
                    expression += ')';
                }
                updateUI();
            }

            function evaluateExpression(){
                const simple = sanitizeForEval(expression);
                if (!simple) return;
                if (!/^[0-9+\-*/().\s]+$/.test(simple)) {
                    previewEl.textContent = 'Err';
                    return;
                }
                try {
                    const val = Function('"use strict"; return (' + simple + ')')();
                    if (typeof val === 'number' && isFinite(val)) {
                        const formatted = Number.isInteger(val) ? String(val) : String(Number(val.toFixed(10))).replace(/\.?0+$/,'');
                        expression = formatted;
                        updateUI();
                    } else {
                        previewEl.textContent = 'Err';
                    }
                } catch (e) {
                    previewEl.textContent = 'Err';
                }
            }

            // Button clicks
            keys.addEventListener('click', e => {
                const btn = e.target.closest('button');
                if (!btn) return;
                const val = btn.getAttribute('data-value');
                const action = btn.getAttribute('data-action');
                if (action === 'clear') { clearAll(); return; }
                if (action === 'del') { del(); return; }
                if (action === 'paren') { toggleParen(); return; }
                if (action === 'equals') { evaluateExpression(); return; }
                if (val) append(val);
            });

            // Keyboard support
            window.addEventListener('keydown', e => {
                // Allow numbers and symbols
                const key = e.key;
                if ((/^[0-9]$/).test(key)) { append(key); e.preventDefault(); return; }
                if (key === '.') { append('.'); e.preventDefault(); return; }
                if (key === '+' || key === '-') { append(key); e.preventDefault(); return; }
                if (key === '*' || key === '/') { append(key); e.preventDefault(); return; }
                if (key === 'Enter' || key === '=') { evaluateExpression(); e.preventDefault(); return; }
                if (key === 'Backspace') { del(); e.preventDefault(); return; }
                if (key === 'Escape') { clearAll(); e.preventDefault(); return; }
                if (key === '(' || key === ')') { append(key); e.preventDefault(); return; }
                // Support × and ÷ via Shift+8 and some layouts: allow x or X to produce multiply
                if (key === 'x' || key === 'X') { append('×'); e.preventDefault(); return; }
                if (key === '÷') { append('÷'); e.preventDefault(); return; }
            });

            // Initialize
            clearAll();
        })();
    </script>
</body>
</html>
